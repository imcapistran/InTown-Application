<!DOCTYPE html lang ="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Events</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="icon" href="images/pin.png"> 
    </head>
    <body>
        <nav class="navBarContainer">
            <div class="navTitle">
                <a href="Home.html"><img src="images/inTown-Logo_Cropped.png" alt="inTown-Logo_Cropped" class="logo"></a>
            </div>

            <div>
                <form id="searchForm">
                    <input id="search" type="search" placeholder="Search by location" name="input_location">
                    <button type="submit" class="submitButton">Search</button>
                </form>
            </div>

            <ul class="navList">
                <li class="navItem"><a href="Event.html">Events</a></li>
                <li class="navItem"><a href="UserProfile.html">User page</a></li>
                <li class="navItem"><a href="/user/logout">Logout</a></li>
            </ul>  
        </nav> 

        <h2>EVENTS</h2>
        <div class="bento_wrapper">
            <div class="bentoContainer" id="locationEventsContainer">
                <!-- Events by location from database are displayed here-->
            </div>
        </div>

<h2>UPCOMING EVENTS</h2>
<div class="bento_wrapper">
    <div class="bentoContainer">
        <div class="card">
            <div class="card-face front">
                <img src="images/art_party.jpeg" alt="Art Party Event">
            </div>
            <div class="card-face back">
                <h4>Art Party</h4>
                <p>Join us for a fun and creative night at the Art Party! Enjoy hands-on painting, live music, and a great time with friends and fellow artists.</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/soiree.jpeg" alt="Art Tour Event">
            </div>
            <div class="card-face back">
                <h4>Surrogacy Soiree</h4>
                <p>Tickets are now on sale to join us at the Surrogacy Soiree. Hosted by The Surrogacy Foundation.</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/rich_people.jpeg" alt="Holiday Bazaar Event">
            </div>
            <div class="card-face back">
                <h4>PMJ Jewels - USA Tour 2024</h4>
                <p>Now in Atlanta, Georgia ready to server for all your Occasions and Celebrations.</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/ribbon_cutting.jpeg" alt="Bike Night Event">
            </div>
            <div class="card-face back">
                <h4>Mountain Lakes Physician Groups Grand Opening!</h4>
                <p>You're invited to our Ribbon Cutting! Please join us to celebrate our new favility from the Rural Health Clinic!</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/pitching.jpeg" alt="Canada Celebration Event">
            </div>
            <div class="card-face back">
                <h4>Baseball Pitching Lessons</h4>
                <p>Available to offer pitching lessons over Thanksgiving break and Christmas break. Thank you!</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/canathon.jpeg" alt="Canathon Event">
            </div>
            <div class="card-face back">
                <h4>Canathon</h4>
                <p>Join us in giving back to the community at our Canathon! Donate non-perishable items to help fight hunger and support those in need during the holiday season.</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/clayton_christmas.jpeg" alt="Clayton Christmas Event">
            </div>
            <div class="card-face back">
                <h4>Clayton Christmas</h4>
                <p>Celebrate Christmas in style at the Clayton Christmas Festival! Enjoy holiday lights, festive performances, and a visit from Santa Claus himself.</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/party4.jpeg" alt="Creative Playtime Event">
            </div>
            <div class="card-face back">
                <h4>Jungle Bells: Closing Ceremony</h4>
                <p>FINAL NIGHT OF JUNGLE BELLS.</p>
            </div> 
        </div>
        <div class="card">
            <div class="card-face front">
                <img src="images/party3.jpeg" alt="Farmers Market Event">
            </div>
            <div class="card-face back">
                <h4>Jungle Bells: Official Late Night</h4>
                <p>GEORGIE RIOT, DOCUMENT ONE, DEGS, ODI, KEITH MACKENZIE, S-DOOBIE, MIXMASTER DOC, KADILAK W/ MCFREAK, ROWDY RANCHER, KAE</p>
            </div> 
        </div>
    </div>
</div>
        
        <!-- events by location-->  
        <script>
            // upon loading page submits empty search form in order to load all events
            document.addEventListener("DOMContentLoaded", async function () {
            const searchForm = document.getElementById("searchForm");
            const searchInput = document.getElementById("search");
            const container = document.getElementById("locationEventsContainer");
            // Add the submit event listener for the form
            searchForm.addEventListener("submit", searchbylocation);

            // Trigger an empty search on page load
                searchInput.value = ""; // Ensure the search input is empty
                await searchbylocation(new Event("submit"));
            });
            
            // get events by location
            document.getElementById("searchForm").addEventListener("submit", searchbylocation);
            async function searchbylocation(event) {
                event.preventDefault(); // Prevent the default form submission

                const inputLocation = document.getElementById("search").value;
                const container = document.getElementById("locationEventsContainer");

                try {
                    // Fetch event data from the server
                    const response = await fetch(`http://localhost:3000/event/bylocation?input_location=${encodeURIComponent(inputLocation)}`);
                    const events = await response.json();
                    console.log(events);

                    // Clear the container
                    container.innerHTML = "";

                    // Loop through events and create cards
                    events.forEach(event => {
                        const labels = ["Free", "$", "$$", "$$$", "$$$$"];
                        const imageUrl = `data:image/jpeg;base64,${event.event_img}`;
                        const card = `
                            <div class="card">
                                <div class="card-face front">
                                    <img src="${imageUrl}" alt="${event.event_name}">
                                </div>
                                <div class="card-face back">
                                    <h4>${event.event_name}</h4>
                                    <p><b>Description:</b> ${event.event_description}</p>
                                    <p><b>Address:</b> ${event.event_location}</p>
                                    <p><b>Start time:</b> ${event.start_time}</p>
                                    <p><b>End Time:</b> ${event.end_time}</p>
                                    <p><b>Cost:</b> ${labels[event.event_cost]}</p>
                                    <p><b>Posted by:</b> ${event.user_name}</p>
                                </div>
                            </div>
                        `;
                        container.innerHTML += card;
                    });
             } catch (error) {
                    console.error("Error fetching events:", error);
                    container.innerHTML = "<p>Error loading events. Please try again later.</p>";
                }
            }
        </script>
    </body>
</html>